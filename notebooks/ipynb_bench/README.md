# –ë–µ–Ω—á–º–∞—Ä–∫ RAG —Å–∏—Å—Ç–µ–º—ã

–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Ç–æ—á–Ω–æ—Å—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –∏–∑ –ë–î —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –ø–æ–∏—Å–∫–∞ –¥–ª—è Retrieval-Augmented Generation (RAG) —Å–∏—Å—Ç–µ–º.


## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö dense –º–æ–¥–µ–ª–µ–π (beir.retrieval.models):
``` {
        "all-MiniLM-L6-v2": SentenceBERT("sentence-transformers/all-MiniLM-L6-v2"),  # 384
        "msmarco-MiniLM-L-6-v3": SentenceBERT("sentence-transformers/msmarco-MiniLM-L-6-v3"),  # 384
        "msmarco-roberta-base-ance-firstp": SentenceBERT("sentence-transformers/msmarco-roberta-base-ance-firstp"),  # 768
    }

```
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ c BM25 `SparseTextEmbedding("Qdrant/bm25")`
- –û—Ü–µ–Ω–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø–æ–∏—Å–∫–∞
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –≤–∏–¥–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –ø–æ–∏—Å–∫–∞ (Exact Search, HNSW (Hierarchical Navigable Small World) –¥–ª—è dense –º–æ–¥–µ–ª–µ–π)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–∏–±—Ä–∏–±–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–∏–¥–∞–º–∏ –≤–µ–∫—Ç–æ—Ä–æ–≤
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥–æ–º ( `sentence_transformers CrossEncoder`) –∏ –±–µ–∑ —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥–∞ 

## –î–∞–Ω–Ω—ã–µ

- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏–ª–æ—Å—å –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–µ —Å 11000 –∑–∞–ø–∏—Å—è–º–∏
- Dense —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –±–µ–Ω—á–º–∞—Ä–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ numpy memmap
- Sparse —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ pkl

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- Qdrant (–∑–∞–ø—É—â–µ–Ω–Ω—ã–π –ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–Ω–æ)
- –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (—Å–º. `requirements.txt`)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –ø–æ–¥—Å—á–µ—Ç–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

```
python embeddings_compute.py
```
–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Å—Ä–∞–∑—É –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã—Ö –º–æ–¥–µ–ª–µ–π –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–æ—Ü–µ—Å—Å –∑–∞–Ω–∏–º–∞–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ 1 —á–∞—Å 30 –º–∏–Ω—É—Ç)

### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
python bench.py
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

```bash
--qdrant-host  # –•–æ—Å—Ç Qdrant —Å–µ—Ä–≤–µ—Ä–∞
--qdrant-port # –ü–æ—Ä—Ç Qdrant —Å–µ—Ä–≤–µ—Ä–∞
--collection-name # –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≤ Qdrant
--topk #–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–≤–ª–µ–∫–∞–µ–º—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
--model-names  # –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
--batch-size # '–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö'
--limit #  –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä            | –û–ø–∏—Å–∞–Ω–∏–µ                                          | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é                                                          |
|---------------------|---------------------------------------------------|--------------------------------------------------------------------------------|
| `--model-names`     | –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è                      | `msmarco-roberta-base-ance-firstp all-MiniLM-L6-v2 msmarco-MiniLM-L-6-v3 BM25` |
| `--limit`           | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è | `11000`                                                                        |
| `--qdrant-host`     | –•–æ—Å—Ç Qdrant —Å–µ—Ä–≤–µ—Ä–∞                               | `localhost`                                                                    |
| `--qdrant-port`     | –ü–æ—Ä—Ç Qdrant —Å–µ—Ä–≤–µ—Ä–∞                               | `6333`                                                                         |
| `--collection-name` | –ø—Ä–µ—Ñ–∏–∫—Å –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≤ Qdrant               | `rag`                                                                          |
| `--topk`            | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è                  | `1 3 5`                                                                        |

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã HNSW

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|----------|-----------------------|
| `--hnsw-ef` | –ü–∞—Ä–∞–º–µ—Ç—Ä ef –¥–ª—è HNSW | `128`                 |
| `--hnsw-m` | –ü–∞—Ä–∞–º–µ—Ç—Ä m –¥–ª—è HNSW (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Å–µ–¥–µ–π) | `32`                  |
| `--ef-construct` | –ü–∞—Ä–∞–º–µ—Ç—Ä ef_construct –¥–ª—è HNSW | `400`                 |

```
python bench.py --model-names BM25 msmarco-roberta-base-ance-firstp --topk 1 3 --limit 11000
python bench.py --hybrid 1 --limit 11000
```

## –ì—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è 11_000 –∑–∞–ø–∏—Å–µ–π:

- —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø–æ–∏—Å–∫–∞ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–æ–≤ –≤ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –∏ –º–µ—Ç–æ–¥–∞–º–∏

![logs/graphs/accuracy_comparison_20250510-191218.png](logs/graphs/accuracy_comparison_20250510-191218.png)

- —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –ª–∏–Ω–µ–π–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞:

![logs/graphs/speed_comparison_20250510-191218.png](logs/graphs/speed_comparison_20250510-191218.png)

- —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø–æ —Ç—Ä–µ–º –º–µ—Ç–æ–¥–∞–º –ø–æ–∏—Å–∫–∞ –¥–ª—è dense –º–æ–¥–µ–ª–µ–π:

![logs/graphs/accuracy_comparison_20250510-193741.png](logs/graphs/accuracy_comparison_20250510-193741.png)

- —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏ –ø–æ–∏—Å–∫–∞ –ø–æ —Ç—Ä–µ–º –º–µ—Ç–æ–¥–∞–º –ø–æ–∏—Å–∫–∞ –¥–ª—è dense –º–æ–¥–µ–ª–µ–π:

![logs/graphs/speed_comparison_20250510-193741.png](logs/graphs/speed_comparison_20250510-193741.png)  

- –∑–∞–ø—É—Å–∫  —Ç–µ—Å—Ç–∞ –¥–ª—è –º–æ–¥–µ–ª–∏ BM25 —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º top_k  

![logs/graphs/accuracy_comparison_20250510-202828.png](logs/graphs/accuracy_comparison_20250510-202828.png)

–ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ 10 –æ—Ç–≤–µ—Ç–æ–≤, —Ç–æ—á–Ω–æ—Å—Ç—å —Å–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è

- –∑–∞–ø—É—Å–∫ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `--hybrid 1` –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –≥–∏–±—Ä–∏–¥–Ω–∞—è –º–æ–¥–µ–ª—å —Å —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥–æ–º, –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–ª—É—á–∞–µ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ:

![logs/graphs/accuracy_comparison_20250510_222542_hybrid.png](logs/graphs/accuracy_comparison_20250510_222542_hybrid.png)

![logs/graphs/speed_comparison_20250510_222542_hybrid.png](logs/graphs/speed_comparison_20250510_222542_hybrid.png)

- —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏  –ø–æ–∏—Å–∫–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ 
  - hnsw-ef 128
  - hnsw-ef 256

![logs/graphs/accuracy_comparison_20250510-225329.png](logs/graphs/accuracy_comparison_20250510-225329.png)

![logs/graphs/accuracy_comparison_20250510-231821.png](logs/graphs/accuracy_comparison_20250510-231821.png)

–û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

```commandline

================================================================================
–†–ï–ó–£–õ–¨–¢–ê–¢–´ –û–¶–ï–ù–ö–ò –°–ö–û–†–û–°–¢–ò –ü–û–ò–°–ö–ê
================================================================================

–ú–æ–¥–µ–ª—å: msmarco-MiniLM-L-6-v3
 –ê–ª–≥–æ—Ä–∏—Ç–º: Exact Search
 –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: 4.37 –º—Å
 –ú–µ–¥–∏–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è: 4.39 –º—Å
 –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: 28.99 –º—Å
 –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: 2.43 –º—Å

–ú–æ–¥–µ–ª—å: msmarco-roberta-base-ance-firstp
 –ê–ª–≥–æ—Ä–∏—Ç–º: Exact Search
 –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: 7.54 –º—Å
 –ú–µ–¥–∏–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è: 7.46 –º—Å
 –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: 30.41 –º—Å
 –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: 3.82 –º—Å

–ú–æ–¥–µ–ª—å: all-MiniLM-L6-v2
 –ê–ª–≥–æ—Ä–∏—Ç–º: Exact Search
 –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: 4.49 –º—Å
 –ú–µ–¥–∏–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è: 4.50 –º—Å
 –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: 28.33 –º—Å
 –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: 2.59 –º—Å

–ú–æ–¥–µ–ª—å: BM25
  –ê–ª–≥–æ—Ä–∏—Ç–º: Exact Search
  –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: 1.73 –º—Å
  –ú–µ–¥–∏–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è: 1.51 –º—Å
  –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: 21.23 –º—Å
  –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: 1.00 –º—Å

================================================================================
–†–ï–ó–£–õ–¨–¢–ê–¢–´ –û–¶–ï–ù–ö–ò –¢–û–ß–ù–û–°–¢–ò –ü–û–ò–°–ö–ê
================================================================================

–ú–æ–¥–µ–ª—å: msmarco-MiniLM-L-6-v3
  –ê–ª–≥–æ—Ä–∏—Ç–º: Exact Search
    Top-1: –¢–æ—á–Ω–æ—Å—Ç—å = 0.7045 (7749/11000)
    Top-3: –¢–æ—á–Ω–æ—Å—Ç—å = 0.7720 (8492/11000)
    Top-5: –¢–æ—á–Ω–æ—Å—Ç—å = 0.7956 (8752/11000)

–ú–æ–¥–µ–ª—å: msmarco-roberta-base-ance-firstp
  –ê–ª–≥–æ—Ä–∏—Ç–º: Exact Search
    Top-1: –¢–æ—á–Ω–æ—Å—Ç—å = 0.7732 (8505/11000)
    Top-3: –¢–æ—á–Ω–æ—Å—Ç—å = 0.8372 (9209/11000)
    Top-5: –¢–æ—á–Ω–æ—Å—Ç—å = 0.8576 (9434/11000)

–ú–æ–¥–µ–ª—å: all-MiniLM-L6-v2
  –ê–ª–≥–æ—Ä–∏—Ç–º: Exact Search
    Top-1: –¢–æ—á–Ω–æ—Å—Ç—å = 0.7570 (8327/11000)
    Top-3: –¢–æ—á–Ω–æ—Å—Ç—å = 0.8245 (9069/11000)
    Top-5: –¢–æ—á–Ω–æ—Å—Ç—å = 0.8465 (9312/11000)

–ú–æ–¥–µ–ª—å: BM25
  –ê–ª–≥–æ—Ä–∏—Ç–º: Exact Search
    Top-1: –¢–æ—á–Ω–æ—Å—Ç—å = 0.8165 (8981/11000)
    Top-3: –¢–æ—á–Ω–æ—Å—Ç—å = 0.8792 (9671/11000)
    Top-5: –¢–æ—á–Ω–æ—Å—Ç—å = 0.8968 (9865/11000)

üìä –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...
‚úÖ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ ./logs/graphs

================================================================================
‚úÖ –ë–ï–ù–ß–ú–ê–†–ö –ó–ê–í–ï–†–®–ï–ù –£–°–ü–ï–®–ù–û
–ì—Ä–∞—Ñ–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ ./logs/graphs/
================================================================================

```

–ö–æ–ª–ª–µ–∫—Ü–∏–∏ –≤ –ë–î:
![logs/graphs/collections.png](logs/graphs/collections.png)

### Reranker

C–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤:
–º–æ–¥–µ–ª—å: `reranker_model = CrossEncoder("cross-encoder/ms-marco-TinyBERT-L-2-v2")`
`reranked_results = sorted(zip(candidates, scores), key=lambda x: x[1], reverse=True)`  

–ö–∞–Ω–¥–∏–¥–∞—Ç—ã –∏ –∏—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –æ—Ü–µ–Ω–∫–∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ —Å–ø–∏—Å–æ–∫ –∫–æ—Ä—Ç–µ–∂–µ–π —Å –ø–æ–º–æ—â—å—é zip. 
–ó–∞—Ç–µ–º —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ –æ—Ü–µ–Ω–∫–∞–º (–≤—Ç–æ—Ä–æ–π —ç–ª–µ–º–µ–Ω—Ç –∫–∞–∂–¥–æ–≥–æ –∫–æ—Ä—Ç–µ–∂–∞), –≤ –ø–æ—Ä—è–¥–∫–µ —É–±—ã–≤–∞–Ω–∏—è (reverse=True). 
–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã —Å –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–º–∏ –æ—Ü–µ–Ω–∫–∞–º–∏ (—Ç.–µ., –±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ) –±—É–¥—É—Ç —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤ –Ω–∞—á–∞–ª–µ.


## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ –æ–±—É—á–µ–Ω–∏—è –Ω–∞–±–æ—Ä–∞ –º–æ–¥–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞—à-—Å–∫—Ä–∏–ø—Ç `example.sh`,
–æ–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç—ã –º–æ–¥–µ–ª–∏ —Å —Ä–∞–∑–Ω–æ–π –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∏ —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `HNSW`, –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ —Å —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥–æ–º –∏ –±–µ–∑ 


### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ dense –º–æ–¥–µ–ª–µ–π

```bash
python bench.py --model-names msmarco-roberta-base-ance-firstp all-MiniLM-L6-v2 msmarco-MiniLM-L-6-v3
```
### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π

```bash
python bench.py --model-names msmarco-roberta-base-ance-firstp all-MiniLM-L6-v2 msmarco-MiniLM-L-6-v3
```
### –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –≤—ã–±–æ—Ä–∫–∏

```bash
python bench.py --limit 1000
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ HNSW

```bash
python bench.py --hnsw-ef 128 --hnsw-m 32 --ef-construct 400
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–Ω—á–º–∞—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è:

- –õ–æ–≥–∏:  `./logs/bench.log` –∏ `./logs/log_timestamp.txt`
- –ì—Ä–∞—Ñ–∏–∫–∏: `./logs/graphs/`

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- `bench.py` - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–µ–Ω—á–º–∞—Ä–∫–∞
- `read_data_from_csv.py` - —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- `config.yml` - —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—É—Ç–∏ –∫ –ø–∞–ø–∫–∞–º –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ –∏ –∫–∞—Ä—Ç–∏–Ω–æ–∫
- `load_config.py` - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—É—Ç–µ–π
- `logger_init.py` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `embeddings_compute.py` - –ø–æ–¥—Å—á–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- `hybrid_rerank.py` - —Å–æ–∑–¥–∞–Ω–∏–µ –≥–∏–±—Ä–∏–¥–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏, –∑–∞–ø—É—Å–∫ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥
- `dense_model.py` - —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å dense –º–æ–¥–µ–ª—è–º–∏ (—á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö/—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–µ–∫ –∑–∞–≥—Ä—É–∑–∫–∏/–∑–∞–≥—Ä—É–∑–∫–∞ –≤ –ë–î/—Ä–∞—Å—Å—á–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏)
- `sparse_bm25.py` - —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ Sparse –º–æ–¥–µ–ª—å—é (—á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö/—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–µ–∫ –∑–∞–≥—Ä—É–∑–∫–∏/–∑–∞–≥—Ä—É–∑–∫–∞ –≤ –ë–î/—Ä–∞—Å—Å—á–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏)
- `report_data.py` - –ø–µ—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –ª–æ–≥ –∏ –Ω–∞ —ç–∫—Ä–∞–Ω
- `visualisation.py` - –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π –∏ –≤–∏–¥–æ–≤ –ø–æ–∏—Å–∫–∞

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º –∑–∞–ø—É—â–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä Qdrant
- –î–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–≤–µ–ª–∏—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `--batch-size` 
- –î–ª—è Sparse –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≤ –ë–î –æ—Ç–∫–ª—é—á–µ–Ω–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `hnsw_config=models.HnswConfigDiff(m=0)`
- –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –≥–∏–±—Ä–∏–¥–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π `optimizer_config=OptimizersConfigDiff(indexing_threshold=5000)`
- –í –∫–∞—á–µ—Å—Ç–≤–µ —Ä–µ—Ä–∞–Ω–∫–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `sentence_transformers-CrossEncoder`
- –í –≥–∏–±—Ä–∏–¥–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç  
  - LateInteractionTextEmbedding("colbert-ir/colbertv2.0")
  - SparseTextEmbedding("Qdrant/bm25")
  - SentenceBERT("msmarco-distilbert-base-tas-b")

## –í—ã–≤–æ–¥—ã:

1. –ü—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ dense –º–æ–¥–µ–ª–µ–π —Å–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å —É —Å–∞–º–æ–π "—Ç—è–∂–µ–ª–æ–π" –º–æ–¥–µ–ª–∏ (msmarco-roberta-base-ance-firstp), –Ω–æ —Å–∫–æ—Ä–æ—Å—Ç—å –∏–∑–≤–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏, —Å–æ–∑–¥–∞–Ω–Ω–æ–π —ç—Ç–æ–π –º–æ–¥–µ–ª—å—é –Ω–∏–∂–µ
2. –õ—É—á—à–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≥–∏–±—Ä–∏–¥–Ω–æ–π –º–æ–¥–µ–ª–∏
3. –° —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥–æ–º —Ç–æ—á–Ω–æ—Å—Ç—å –≤—ã—à–µ
3. –°–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π BM25
4. –ì–∏–±—Ä–∏–¥–Ω–∞—è –º–æ–¥–µ–ª—å –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å BM25
